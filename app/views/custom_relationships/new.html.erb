<div class="max-w-4xl mx-auto py-8 px-4">
  <%= render "shared/breadcrumbs", crumbs: [[@custom_table.name, table_path(@custom_table)], ["Edit", edit_table_path(@custom_table)]] %>
  <%= render "shared/page_heading", title: "New relationship" %>

  <%= form_with model: @custom_relationship, url: table_relationships_path(@custom_table),
    html: { novalidate: true },
    data: {
      controller: "relationship-form",
      relationship_form_source_table_value: @custom_table.name,
      relationship_form_source_table_singular_value: @custom_table.name.singularize,
      relationship_form_source_table_id_value: @custom_table.id
    } do |form| %>

    <%= render "shared/dropdown", form: form, field: :target_table_id, label: "Related table", required: true, searchable: true, autofocus: true,
      selected: @custom_relationship.target_table_id,
      options: @available_tables.map { |t| [t.name, t.id, { "data-singular" => t.name.singularize }] },
      input_data: { relationship_form_target: "targetTableId", action: "change->relationship-form#updateDefaults" } %>

    <%= render "shared/dropdown", form: form, field: :kind, label: "Kind", required: true,
      selected: @custom_relationship.kind,
      options: [["One to one", "one_to_one"], ["One to many", "one_to_many"], ["Many to one", "many_to_one"], ["Many to many", "many_to_many"]],
      input_data: { relationship_form_target: "kind", action: "change->relationship-form#updateDefaults" } %>

    <div class="hidden" data-relationship-form-target="directionContainer">
      <%= render "shared/radio_group", form: form, field: :symmetric, label: "Direction",
        selected: "1",
        options: [["Symmetric", "1"], ["Asymmetric", "0"]],
        input_data: { relationship_form_target: "symmetric", action: "change->relationship-form#updateDefaults" } %>
    </div>

    <div class="mb-4">
      <%= form.label :name, class: "block text-sm font-medium text-gray-700 mb-1" do %>
        Name<span class="text-red-500 ml-0.5">*</span>
      <% end %>
      <%= form.text_field :name,
        required: true,
        placeholder: "e.g. Deals, Projects, Tasks",
        data: { relationship_form_target: "name" },
        class: "block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm focus:border-gray-500 focus:outline-none focus:ring-1 focus:ring-gray-500" %>
    </div>

    <div class="mb-4" data-relationship-form-target="inverseNameContainer">
      <%= form.label :inverse_name, class: "block text-sm font-medium text-gray-700 mb-1" do %>
        Inverse name<span class="text-red-500 ml-0.5">*</span>
      <% end %>
      <%= form.text_field :inverse_name,
        required: true,
        placeholder: "e.g. Contact, Company",
        data: { relationship_form_target: "inverseName" },
        class: "block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm focus:border-gray-500 focus:outline-none focus:ring-1 focus:ring-gray-500" %>
    </div>

    <div class="flex items-center gap-3">
      <%= render "shared/button", label: "Add relationship", form: form %>
      <%= render "shared/button", style: "ghost", label: "Cancel", href: edit_table_path(@custom_table) %>
    </div>
  <% end %>
</div>
