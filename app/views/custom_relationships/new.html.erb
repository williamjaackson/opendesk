<div class="max-w-4xl mx-auto py-8 px-4">
  <%= render "shared/breadcrumbs", crumbs: [[@custom_table.name, custom_table_path(@custom_table)], ["Edit", edit_custom_table_path(@custom_table)]] %>
  <%= render "shared/page_heading", title: "New relationship" %>

  <%= form_with model: [@custom_table, @custom_relationship],
    data: {
      controller: "relationship-form",
      relationship_form_source_table_value: @custom_table.name,
      relationship_form_source_table_singular_value: @custom_table.name.singularize
    } do |form| %>

    <div class="mb-4">
      <%= form.label :name, class: "block text-sm font-medium text-gray-700 mb-1" do %>
        Name<span class="text-red-500 ml-0.5">*</span>
      <% end %>
      <%= form.text_field :name,
        required: true,
        placeholder: "e.g. Deals, Projects, Tasks",
        data: { relationship_form_target: "name" },
        class: "block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm focus:border-gray-500 focus:outline-none focus:ring-1 focus:ring-gray-500" %>
    </div>

    <%= render "shared/dropdown", form: form, field: :target_table_id, label: "Related table", required: true, searchable: true,
      selected: @custom_relationship.target_table_id,
      options: @available_tables.map { |t| [t.name, t.id, { "data-singular" => t.name.singularize }] },
      input_data: { relationship_form_target: "targetTableId", action: "change->relationship-form#updateDefaults" } %>

    <%= render "shared/dropdown", form: form, field: :kind, label: "Kind", required: true,
      selected: @custom_relationship.kind,
      options: [["Has one", "has_one"], ["Has many", "has_many"], ["Many to many", "many_to_many"]],
      input_data: { relationship_form_target: "kind", action: "change->relationship-form#updateDefaults" } %>

    <div class="mb-4">
      <%= form.label :inverse_name, class: "block text-sm font-medium text-gray-700 mb-1" do %>
        Inverse name<span class="text-red-500 ml-0.5">*</span>
      <% end %>
      <%= form.text_field :inverse_name,
        required: true,
        placeholder: "e.g. Contact, Company",
        data: { relationship_form_target: "inverseName" },
        class: "block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm focus:border-gray-500 focus:outline-none focus:ring-1 focus:ring-gray-500" %>
    </div>

    <%= render "shared/button", label: "Add relationship", form: form %>
  <% end %>
</div>
