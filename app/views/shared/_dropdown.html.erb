<%# locals: (form:, field:, options:, label: nil, selected: nil, placeholder: "Select...") %>
<% selected_option = options.find { |o| o[1].to_s == selected.to_s } %>

<div class="mb-4">
  <% if label %>
    <%= form.label field, label, class: "block text-sm font-medium text-gray-700 mb-1" %>
  <% else %>
    <%= form.label field, class: "block text-sm font-medium text-gray-700 mb-1" %>
  <% end %>

  <div data-controller="dropdown" class="relative">
    <%= form.hidden_field field, data: { dropdown_target: "input" } %>

    <button type="button" data-action="dropdown#toggle" data-dropdown-target="button"
      class="flex items-center justify-between w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm focus:border-gray-500 focus:outline-none focus:ring-1 focus:ring-gray-500 cursor-pointer">
      <span data-dropdown-target="label" class="<%= selected_option ? 'text-gray-900' : 'text-gray-400' %>">
        <%= selected_option ? selected_option[0] : placeholder %>
      </span>
      <%= lucide_icon("chevron-down", class: "h-4 w-4 text-gray-400") %>
    </button>

    <div data-dropdown-target="menu" class="hidden absolute z-10 mt-1 w-full rounded-md border border-gray-200 bg-white shadow-lg py-1 max-h-60 overflow-y-auto">
      <% options.each do |option_label, option_value| %>
        <button type="button" data-action="dropdown#select" data-value="<%= option_value %>" data-label="<%= option_label %>"
          class="flex items-center justify-between w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">
          <span><%= option_label %></span>
          <span data-check class="<%= 'invisible' unless option_value.to_s == selected.to_s %>">
            <%= lucide_icon("check", class: "h-4 w-4 text-gray-900") %>
          </span>
        </button>
      <% end %>
    </div>
  </div>
</div>
