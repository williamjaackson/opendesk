<div class="max-w-4xl mx-auto py-8 px-4">
  <%= render "shared/breadcrumbs", crumbs: [[@custom_table.name, table_path(@custom_table)]] %>
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-bold text-gray-900">Record</h1>
    <%= link_to edit_table_record_path(@custom_table, @custom_record), class: "p-1.5 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors" do %>
      <%= lucide_icon("pencil", class: "h-4 w-4") %>
    <% end %>
  </div>

  <dl class="space-y-4">
    <% @columns.each do |column| %>
      <div>
        <dt class="text-sm font-medium text-gray-500"><%= column.name %></dt>
        <% raw_value = @custom_record.custom_values.detect { |v| v.custom_column_id == column.id }&.value %>
        <dd class="mt-1 text-sm text-gray-900"><%= format_column_value(column, raw_value).presence || "â€”" %></dd>
      </div>
    <% end %>
  </dl>

  <% if @relationship_sections.any? %>
    <div class="pt-8 space-y-8">
      <% @relationship_sections.chunk { |s| s.self_referential ? s.relationship.id : nil }.each do |rel_id, sections| %>
        <% if rel_id %>
          <%= turbo_frame_tag "related_#{rel_id}" do %>
            <div class="space-y-8">
              <% sections.each do |section| %>
                <%= render "related_records", section: section, record: @custom_record %>
              <% end %>
            </div>
          <% end %>
        <% else %>
          <% sections.each do |section| %>
            <%= render "related_records", section: section, record: @custom_record %>
          <% end %>
        <% end %>
      <% end %>
    </div>
  <% end %>

</div>
