<div class="max-w-4xl mx-auto py-8 px-4">
  <%= render "shared/breadcrumbs", crumbs: [[@custom_table.name, table_path(@custom_table)], ["Record", table_record_path(@custom_table, @custom_record)]] %>
  <%= render "shared/page_heading", title: "Edit record" %>

  <div class="space-y-8">
    <%= form_with url: table_record_path(@custom_table, @custom_record), method: :patch, html: { novalidate: true } do |form| %>
      <% @columns.reject(&:computed?).each do |column| %>
        <% existing_value = @custom_record.custom_values.detect { |v| v.custom_column_id == column.id }&.value %>
        <div class="mb-4">
          <% unless column.column_type == "boolean" %>
            <%= label_tag "values_#{column.id}", class: "block text-sm font-medium text-gray-700 mb-1" do %>
              <%= column.name %><% if column.required? %><span class="text-red-500 ml-0.5">*</span><% end %>
            <% end %>
          <% end %>
          <%= column_value_tag(column, params.dig(:values, column.id.to_s) || existing_value, required: column.required?, errors: @custom_record.errors[:"column_#{column.id}"].any?) %>
          <% @custom_record.errors[:"column_#{column.id}"].each do |message| %>
            <p class="mt-1 text-sm text-red-600"><%= message %></p>
          <% end %>
        </div>
      <% end %>

      <div class="flex items-center gap-3">
        <%= render "shared/button", label: "Save changes", form: form %>
        <%= render "shared/button", style: "ghost", label: "Cancel", href: table_record_path(@custom_table, @custom_record) %>
      </div>
    <% end %>

    <%= render "shared/danger_zone",
      description: "Deleting this record will permanently remove all its values and links.",
      path: table_record_path(@custom_table, @custom_record),
      button_label: "Delete record",
      confirm: "Are you sure you want to delete this record?" %>
  </div>
</div>
